{% extends 'base.html' %}
{% block title %}
<title>Sign Up</title>
{% endblock %}
{% block content %}
<div class="min-h-screen flex items-center justify-center bg-white">
    <div class="w-full max-w-3xl bg-white rounded-lg shadow-lg p-8 border-t-4 border-gray-600">
        <h2 class="text-xl font-bold text-gray-600 mb-6 text-center">Sign Up To Our Platform</h2>
        <form action="{% url 'register_user' %}" method="POST" enctype="multipart/form-data" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {% csrf_token %}
            <div>
                <label for="first_name" class="block text-gray-700 mb-1">First Name</label>
                <input type="text" id="first_name" name="first_name" placeholder="First Name" required
                    class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
            </div>
            <div>
                <label for="last_name" class="block text-gray-700 mb-1">Last Name</label>
                <input type="text" id="last_name" name="last_name" placeholder="Last Name" required
                    class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
            </div>
            <div>
                <label for="username" class="block text-gray-700 mb-1">Username</label>
                <input type="text" id="username" name="username" placeholder="Username" required
                    class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
            </div>
            <div>
                <label for="email" class="block text-gray-700 mb-1">Email</label>
                <input type="email" id="email" name="email" placeholder="Email" required
                    class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
            </div>
            <div>
                <label for="password1" class="block text-gray-700 mb-1">Password</label>
                <input type="password" id="password1" name="password1" placeholder="Password" required
                    class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
            </div>
            <div>
                <label for="password2" class="block text-gray-700 mb-1">Confirm Password</label>
                <input type="password" id="password2" name="password2" placeholder="Confirm Password" required
                    class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
            </div>
            <div class="md:col-span-2">
                <label for="role" class="block text-gray-700 mb-1">What best describes you?</label>
                <select name="role" id="role" required
                    class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray">
                    <option value="" disabled selected>What best describes you?</option>
                    <option value="applicant">An applicant looking for Security Jobs</option>
                    <option value="employer">A Security Firm looking to rectruit new security officers</option>
                    <option value="client">An Organization/Individual looking to hire a Security Firm</option>
                </select>
            </div>
            <div id="applicant-section" class="md:col-span-2" style="display:none;">
                {{ applicant_form.as_p }}
            </div>

            <div id="employer-section" class="md:col-span-2" style="display:none;">
                <div class="mb-2">
                    <label for="name" class="block text-gray-700 mb-1">Company Name</label>
                    <input type="text" id="name" name="name" placeholder="Company Name" required
                        class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
                </div>
                <div class="mb-1">
                    <label for="logo" class="block text-gray-700 mb-1">Company Logo</label>
                    <input type="file" id="logo" name="logo"
                        class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
                </div>
                <div class="mb-2">
                    <label for="description" class="block text-gray-700 mb-1">Description</label>
                    <textarea id="description" name="description" placeholder="Company Description" required
                        class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray"></textarea>
                </div>
                <div class="mb-2">
                    <label for="location" class="block text-gray-700 mb-1">Location</label>
                    <input type="text" id="location" name="location" placeholder="Location" required
                        class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
                </div>
                <div class="mb-2">
                    <label for="services_offered" class="block text-gray-700 mb-1">Services Offered</label>
                    <input type="text" id="services_offered" name="services_offered" placeholder="Services Offered"
                        required
                        class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
                </div>
            </div>

            <div id="client-section" class="md:col-span-2" style="display:none;">
                <div class="mb-2">
                    <label for="company_name" class="block text-gray-700 mb-1">Company Name</label>
                    <input type="text" id="company_name" name="company_name" placeholder="Company Name" required
                        class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
                </div>
                <div class="mb-2">
                    <label for="address" class="block text-gray-700 mb-1">Address</label>
                    <input type="text" id="address" name="address" placeholder="Address" required
                        class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
                </div>
                <div class="mb-2">
                    <label for="phone" class="block text-gray-700 mb-1">Phone</label>
                    <input type="tel" id="phone" name="phone" placeholder="Phone" required
                        class="w-full px-4 py-2 rounded border border-gray-200 bg-white text-dark-gray focus:outline-none focus:border-dark-gray" />
                </div>
            </div>
            <div class="md:col-span-2">
                <input type="submit" value="Create Account"
                    class="w-full mt-4 py-2 bg-gray-600 text-white font-semibold rounded hover:bg-gray-700 transition" />
            </div>
        </form>
        <div class="mt-6 text-center">
            <p class="text-gray-500">Already have an account?
                <a href="{% url 'log_in' %}" class="text-blue-600 hover:underline">Log In</a>
            </p>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show/hide sections and toggle required attributes based on role
    const roleSelect = document.getElementById('role');
    const applicantSection = document.getElementById('applicant-section');
    const employerSection = document.getElementById('employer-section');
    const clientSection = document.getElementById('client-section');

    function setRequired(section, required) {
        if (!section) return;
        const inputs = section.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            if (required) {
                input.setAttribute('required', 'required');
            } else {
                input.removeAttribute('required');
            }
        });
    }

    function handleRoleChange() {
        const role = roleSelect.value;
        applicantSection.style.display = 'none';
        employerSection.style.display = 'none';
        clientSection.style.display = 'none';
        setRequired(applicantSection, false);
        setRequired(employerSection, false);
        setRequired(clientSection, false);

        if (role === 'applicant') {
            applicantSection.style.display = '';
            setRequired(applicantSection, true);
        } else if (role === 'employer') {
            employerSection.style.display = '';
            setRequired(employerSection, true);
        } else if (role === 'client') {
            clientSection.style.display = '';
            setRequired(clientSection, true);
        }
    }

    if (roleSelect) {
        roleSelect.addEventListener('change', handleRoleChange);
        handleRoleChange(); // Initialize on page load
    }

    // Debug submit button click
    const submitBtn = document.querySelector('input[type="submit"]');
    if (submitBtn) {
        submitBtn.addEventListener('click', function(e) {
            console.log('Submit button clicked');
        });
    }
});
</script>
{% endblock %}